# AGENTS.md

This file provides guidance for agents generated by the ADL CLI when working with their generated codebase.

## Project Overview

Generated A2A (Agent-to-Agent) servers implement the [A2A Protocol](https://github.com/inference-gateway/adk) for agent-to-agent communication. Projects are automatically generated from ADL (Agent Definition Language) specifications defined in `agent.yaml`.

## Key Architecture Components

### Core Components
- **Main Entry Point**: `main.go` - Configures and starts the A2A server with agent provider configuration and graceful shutdown handling
- **Agent Configuration**: `.well-known/agent.json` - Serves agent metadata at runtime
- **Skills Implementation**: Generated skill files with TODO placeholders for business logic
- **Environment Configuration**: Extensive env vars with `A2A_` prefix for runtime configuration

### ADL-Generated Structure

The codebase follows a strict generation pattern:
- **Generated Files**: Marked with `DO NOT EDIT` headers - manual changes will be overwritten
- **Configuration Source**: `agent.yaml` - defines agent capabilities, skills, and metadata
- **Server Implementation**: Built on the ADK (Agent Development Kit) framework from `github.com/inference-gateway/adk`

## Development Commands

### Basic Operations
```bash
# Generate/regenerate code from ADL specification
task generate

# Run the agent in development mode (debug enabled)
task run

# Build the agent binary
task build

# Run tests (add tests to your implementation)
task test
task test:cover  # with coverage

# Code quality
task lint         # Run golangci-lint
task fmt          # Format code

# Clean build artifacts
task clean
```

### Docker Operations
```bash
# Build Docker image
task docker:build

# Run with Docker
docker run -p 8080:8080 your-agent-name
```

## Development Workflow

### Skills Implementation
1. **Locate Skill Files**: Skills are generated in the `skills/` directory with TODO placeholders
2. **Implement Business Logic**: Replace TODO comments with actual skill implementations
3. **Follow ADK Patterns**: Use the ADK framework patterns for request handling and response formatting
4. **Add Tests**: Create `*_test.go` files alongside skill implementations

### Agent Configuration
- **System Prompt**: Edit in `agent.yaml`, then regenerate
- **Capabilities**: Modify in `agent.yaml` (streaming, pushNotifications, stateTransitionHistory)
- **Server Configuration**: Update environment variables or `agent.yaml` server section

### Adding New Skills
1. Update `agent.yaml` with new skill definitions
2. Run `task generate` to regenerate the codebase
3. Implement skill logic in newly generated skill files
4. Write tests for each skill

## LLM Provider Configuration

Configure your AI provider with environment variables:
- `A2A_AGENT_CLIENT_PROVIDER`: `openai`, `anthropic`, `azure`, `ollama`, `deepseek`
- `A2A_AGENT_CLIENT_MODEL`: Model identifier (e.g., `gpt-4o-mini`, `claude-3-haiku`)
- `A2A_AGENT_CLIENT_API_KEY`: Provider API key
- `A2A_AGENT_CLIENT_BASE_URL`: Custom endpoint (optional)

## Testing Strategy

When implementing tests:
- Create `*_test.go` files alongside implementation files
- Use table-driven tests for comprehensive coverage
- Mock external dependencies (LLM client, Redis if used)
- Test A2A protocol compliance with integration tests
- Test skill implementations with various input scenarios

## Testing Individual Components

```bash
# Run specific test file
go test -v ./skills -run TestSpecificSkill

# Debug with A2A Debugger
docker run --rm -it --network host ghcr.io/inference-gateway/a2a-debugger:latest \
  --server-url http://localhost:8080 tasks submit "Your query"
```

## Code Patterns and Conventions

### Go Code Style
- Follow standard Go conventions and gofmt formatting
- Use table-driven testing for all tests
- Prefer early returns to avoid deep nesting
- Always use lowercase log messages
- Code to interfaces for easier mocking in tests
- Each test case should have isolated mock dependencies
- Always ensure a new line at the end of files

### Skill Development
- Keep skill implementations focused on single responsibilities
- Use the ADK skill framework for consistent request/response handling
- Implement proper error handling with meaningful error messages
- Add comprehensive logging for debugging
- Validate input parameters according to skill schemas

## Environment Management

Projects may include environment configuration:
- **Flox**: Environment configuration in `.flox/env/manifest.toml`
- **DevContainer**: Development container configuration in `.devcontainer/`
- **Task Runner**: Uses Task (https://taskfile.dev) for build automation

### Development Environment Setup

Standard development environment required:
- Go 1.25+ (or version specified in agent.yaml)
- Task runner (`go install github.com/go-task/task/v3/cmd/task@latest`)
- Docker (for containerized operations)

## Important Constraints

- **Generated Files**: Never manually edit files with "DO NOT EDIT" headers
- **Configuration Changes**: Always modify `agent.yaml` and regenerate
- **ADL Version**: Ensure compatible ADL CLI version for regeneration
- **Port Configuration**: Default 8080, configurable via `A2A_PORT` or `A2A_SERVER_PORT`

## Debugging Tips

- Enable debug mode: `A2A_DEBUG=true`
- Check health: `GET /health`
- View agent metadata: `GET /.well-known/agent.json`
- Monitor streaming updates: Set `A2A_STREAMING_STATUS_UPDATE_INTERVAL`
- Use A2A Debugger container for interactive testing
- Check logs for skill execution details
- Validate ADL file before regenerating: `adl validate agent.yaml`

## Deployment

Generated agents include Docker configuration and can be deployed to:
- Kubernetes (if deployment config included)
- Google Cloud Run (if deployment config included)
- Any container platform supporting Docker images
- Direct binary deployment with proper environment configuration